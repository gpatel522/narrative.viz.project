<html>
<head>
<style>
.button {
  border: none;
  color: white;
  padding: 15px 15px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 14px;
  margin: 4px 2px;
  cursor: pointer;
  width: 120px;
}

.type1 {background-color: #4CAF50;} /* Green */
.type2 {background-color: #008CBA;} /* Blue */
.tab {
	display: inline-block;
	margin-left: 40px;
}
</style>
</head>
<script src='https://d3js.org/d3.v5.min.js'></script>
<body onload='init()'>
<button class="button type1" id="AnyButton">Any type</button>
<button class="button type1" id="ElectricButton">Electric</button>
<button class="button type1" id="3Button">3 cylinders</button>
<button class="button type1" id="4Button">4 cylinders</button>
<button class="button type1" id="6Button">6 cylinders</button>
<button class="button type1" id="8Button">8 cylinders</button>
<button class="button type1" id="10Button">10 cylinders</button>
<button class="button type1" id="12Button">12 cylinders</button>
</p>
<div id="my_dataviz"></div>
<!--svg viewBox="0 0 300 300" align: center></svg-->
<script>
const data = new Array();
var defaultFill = "lightblue"
var highlightFill = "lightgreen"
async function init() 
{
	let fileRows = new Array();
	await fetch("https://flunky.github.io/cars2017.csv")
	   .then(reader => reader.text())
	   .then(function(text){ fileRows = text.split('\n'); });
	   
	fileRows.shift(); //remove header row
	fileRows.pop(); //remove trailing /n
	fileRows.splice(15, 1); //some cleanup - removing 2 cylinders since its only 1 car
	
	fileRows.forEach(element => data.push(element.split(',')));
	
	initLeftChart();
	initRightChart();
}

function initRightChart() 
{
	
}

function initLeftChart() 
{
	var fx = d3.scaleLog().domain([10,150]).range([0,200]);
	var fy = d3.scaleLog().domain([10,150]).range([200,0]);
	var width = 700;
	var height = 700;
	var witdthMargin = 80;
	var heightMargin = 50;
	var scalefactor = 400;

	var graph = d3.select("#my_dataviz")
				 .append("svg")
				 .attr("viewBox","0,0,"+scalefactor+","+scalefactor)
				 .attr("width",width + 2*witdthMargin)
				 .attr("height",height + 2*heightMargin)
				 .append("g");

	var tooltip = d3.select("#my_dataviz")
					.append("div")
					.attr("class", "tooltip")
					.style("visibility", "hidden")
					.style("background-color", "white")
					.style("border", "solid")
					.style("border-width", "2px")
					.style("border-radius", "5px")
					.style("padding", "5px")
					.text("I'm a circle!")
					.style("position", "absolute");
					//.text("I'm a circle!");

	var circle = graph.attr("transform","translate("+witdthMargin+","+heightMargin+")")
				    .selectAll("g")
				    .data(data)
				    .enter()
				    .append("circle")
				    .attr("id", function(d,i) { return "circle" + i; })
				    .attr("cx", function(d,i) { return fx(d[4]); })
				    .attr("cy", function(d,i) { return fy(d[3]); })
				    .attr("r", function(d) { return parseInt(d[2])+2; })
				    .attr("fill", defaultFill)
				    .attr("stroke", "blue")
				    .on("mouseover", 
						function(d,i)
						{
							d3.select(this).attr("fill",highlightFill);
							return tooltip.style("top",  (d3.mouse(this)[1]) + height/2-heightMargin + "px")
										.style("left", (d3.mouse(this)[0]) + width/2-witdthMargin + "px")
										.html("<p>Make:\t" + d[0] + 
											"</br>Fuel:\t" + d[1] + 
											"</br>Cylinders:\t" + d[2] + 
											"</br>AvgHighwayMPG:\t" + d[3] + 
											"</br>AvgCityMPG:\t" + d[4])
										.style("visibility", "visible");
						})
					.on("mousemove", 
						function(d,i)
						{
							return tooltip.style("top",  (d3.mouse(this)[1]) + height/2-heightMargin + "px")
										.style("left", (d3.mouse(this)[0]) + width/2-witdthMargin + "px");
						})
				   .on("mouseout", 
						function(d,i)
						{
							d3.select(this).attr("fill",defaultFill);
							return tooltip.style("visibility", "hidden");
						});
	
	//d3.select("svg").selectAll("#circle1").attr("fill","red");

	d3.select("svg")
	 .attr("width",width + 2*witdthMargin)
	 .attr("height",height + 2*heightMargin)
	 .append("g")
	 .attr("transform","translate("+witdthMargin+","+heightMargin+")")
	 .call(d3.axisLeft(fy).tickValues([10,20,50,100]).tickFormat((d, i) => [10,20,50,100][i]));

	d3.select("svg")
	 .attr("width",width + 2*witdthMargin)
	 .attr("height",height + 2*heightMargin)
	 .append("g")
	 .attr("transform","translate("+witdthMargin+","+250+")")
	 .call(d3.axisBottom(fx).tickValues([10,20,50,100]).tickFormat((d, i) => [10,20,50,100][i]));
	
	d3.select("svg").append("text")
     .attr("class", "x label")
     .attr("text-anchor", "end")
     .attr("font-size", "10")
     .attr("x", width-490)
     .attr("y", height-415)
     .text("Average MPG City");
	d3.select("svg").append("text")
     .attr("class", "y label")
     .attr("text-anchor", "end")
     .attr("y", 8)
     .attr("font-size", "10")
     .attr("y", width-650)
     .attr("x", height-810)
     .attr("transform", "rotate(-90)")
     .text("Average MPG Highway");
	 
	d3.selectAll("button").on("click",
		function(d,index)
		{
			if (index == 0) //Any
			{
				d3.select("svg").selectAll("circle").style("visibility", "visible")
			}
			else if (index == 1) // Electric
			{
				for (var i = 0; i < data.length; i++) 
				{
					if (data[i][2] == 0)
						d3.select("svg").selectAll("#circle" + i).style("visibility", "visible")
					else
						d3.select("svg").selectAll("#circle" + i).style("visibility", "hidden")
				}
			}
			else if (index == 2) //3 cyl
			{
				for (var i = 0; i < data.length; i++) 
				{
					if (data[i][2] == 3)
						d3.select("svg").selectAll("#circle" + i).style("visibility", "visible")
					else
						d3.select("svg").selectAll("#circle" + i).style("visibility", "hidden")
				}
			}
			else if (index == 3) //4 cyl
			{
				for (var i = 0; i < data.length; i++) 
				{
					if (data[i][2] == 4)
						d3.select("svg").selectAll("#circle" + i).style("visibility", "visible")
					else
						d3.select("svg").selectAll("#circle" + i).style("visibility", "hidden")
				}
			}
			else if (index == 4) //6 cyl
			{
				for (var i = 0; i < data.length; i++) 
				{
					if (data[i][2] == 6)
						d3.select("svg").selectAll("#circle" + i).style("visibility", "visible")
					else
						d3.select("svg").selectAll("#circle" + i).style("visibility", "hidden")
				}
			}
			else if (index == 5) //8 cyl
			{
				for (var i = 0; i < data.length; i++) 
				{
					if (data[i][2] == 8)
						d3.select("svg").selectAll("#circle" + i).style("visibility", "visible")
					else
						d3.select("svg").selectAll("#circle" + i).style("visibility", "hidden")
				}
			}
			else if (index == 6) //10 cyl
			{
				for (var i = 0; i < data.length; i++) 
				{
					if (data[i][2] == 10)
						d3.select("svg").selectAll("#circle" + i).style("visibility", "visible")
					else
						d3.select("svg").selectAll("#circle" + i).style("visibility", "hidden")
				}
			}
			else if (index == 7) //12 cyl
			{
				for (var i = 0; i < data.length; i++) 
				{
					if (data[i][2] == 12)
						d3.select("svg").selectAll("#circle" + i).style("visibility", "visible")
					else
						d3.select("svg").selectAll("#circle" + i).style("visibility", "hidden")
				}
			}
		});
}
</script>
</body>
</html>