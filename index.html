<html>
<head>
<style>
.button {
  border: none;
  color: white;
  padding: 15px 15px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 14px;
  margin: 4px 2px;
  cursor: pointer;
  width: 120px;
}

.type1 {background-color: #4CAF50;} /* Green */
.type2 {background-color: #008CBA;} /* Blue */
.grid-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-gap: 20px;
}
.grid-child {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-gap: 20px;
	border: 1px outset red;
}
</style>
</head>
<script src='https://d3js.org/d3.v5.min.js'></script>
<body onload='init()'>
<button class="button type1" id="AnyButton">Any type</button>
<button class="button type1" id="ElectricButton">Electric</button>
<button class="button type1" id="3Button">3 cylinders</button>
<button class="button type1" id="4Button">4 cylinders</button>
<button class="button type1" id="6Button">6 cylinders</button>
<button class="button type1" id="8Button">8 cylinders</button>
<button class="button type1" id="10Button">10 cylinders</button>
<button class="button type1" id="12Button">12 cylinders</button>
</p>
<div class="grid-container">
<div id="my_dataviz1" class="grid-child"></div>
<div id="my_dataviz2" class="grid-child"></div>
</div>
<!--svg viewBox="0 0 300 300" align: center></svg-->
<script>
const data = new Array();
const avgData = new Array();
var defaultFill = "lightblue"
var highlightFill = "lightgreen"
async function init() 
{
	let fileRows = new Array();
	await fetch("https://flunky.github.io/cars2017.csv")
	   .then(reader => reader.text())
	   .then(function(text){ fileRows = text.split('\n'); });
	   
	fileRows.shift(); //remove header row
	fileRows.pop(); //remove trailing /n
	fileRows.splice(15, 1); //some cleanup - removing 2 cylinders since its only 1 car
	fileRows.forEach(element => data.push(element.split(',')));
	
	
	let fileRows2 = new Array();
	await fetch("AverageData.csv")
	   .then(reader => reader.text())
	   .then(function(text){ fileRows2 = text.split('\n'); });
	  
	fileRows2.shift(); //remove header row
	fileRows2.pop(); //remove trailing /n
	fileRows2.splice(15, 1); //some cleanup - removing 2 cylinders since its only 1 car
	fileRows2.forEach(element => avgData.push(element.split(',')));
	console.log(avgData);
	
	initLeftChart();
	initRightChart();
	hookupButtonListeners();
}
function hookupButtonListeners()
{
	d3.selectAll("button").on("click",
		function(d,index)
		{
			for (var i = 0; i < 16; i++)
			{
				if (i == index*2-1 || i == index*2-2 || index == 0)
				{
					d3.select("#my_dataviz2").select("svg").selectAll("#rect" + i).style("opacity", "1");
				}
				else
				{
					d3.select("#my_dataviz2").select("svg").selectAll("#rect" + i).style("opacity", "0.25");
				}
			}
			if (index == 0) //Any
			{
				d3.select("#my_dataviz1").select("svg").selectAll("circle").style("visibility", "visible");
			}
			else if (index == 1) // Electric
			{
				for (var i = 0; i < data.length; i++) 
				{
					if (data[i][2] == 0)
						d3.select("#my_dataviz1").select("svg").selectAll("#circle" + i).style("visibility", "visible")
					else
						d3.select("#my_dataviz1").select("svg").selectAll("#circle" + i).style("visibility", "hidden")
				}
			}
			else if (index == 2) //3 cyl
			{
				for (var i = 0; i < data.length; i++) 
				{
					if (data[i][2] == 3)
						d3.select("#my_dataviz1").select("svg").selectAll("#circle" + i).style("visibility", "visible")
					else
						d3.select("#my_dataviz1").select("svg").selectAll("#circle" + i).style("visibility", "hidden")
				}
			}
			else if (index == 3) //4 cyl
			{
				for (var i = 0; i < data.length; i++) 
				{
					if (data[i][2] == 4)
						d3.select("#my_dataviz1").select("svg").selectAll("#circle" + i).style("visibility", "visible")
					else
						d3.select("#my_dataviz1").select("svg").selectAll("#circle" + i).style("visibility", "hidden")
				}
			}
			else if (index == 4) //6 cyl
			{
				for (var i = 0; i < data.length; i++) 
				{
					if (data[i][2] == 6)
						d3.select("#my_dataviz1").select("svg").selectAll("#circle" + i).style("visibility", "visible")
					else
						d3.select("#my_dataviz1").select("svg").selectAll("#circle" + i).style("visibility", "hidden")
				}
			}
			else if (index == 5) //8 cyl
			{
				for (var i = 0; i < data.length; i++) 
				{
					if (data[i][2] == 8)
						d3.select("#my_dataviz1").select("svg").selectAll("#circle" + i).style("visibility", "visible")
					else
						d3.select("#my_dataviz1").select("svg").selectAll("#circle" + i).style("visibility", "hidden")
				}
			}
			else if (index == 6) //10 cyl
			{
				for (var i = 0; i < data.length; i++) 
				{
					if (data[i][2] == 10)
						d3.select("#my_dataviz1").select("svg").selectAll("#circle" + i).style("visibility", "visible")
					else
						d3.select("#my_dataviz1").select("svg").selectAll("#circle" + i).style("visibility", "hidden")
				}
			}
			else if (index == 7) //12 cyl
			{
				for (var i = 0; i < data.length; i++) 
				{
					if (data[i][2] == 12)
						d3.select("#my_dataviz1").select("svg").selectAll("#circle" + i).style("visibility", "visible")
					else
						d3.select("#my_dataviz1").select("svg").selectAll("#circle" + i).style("visibility", "hidden")
				}
			}
		});
}
function initRightChart() 
{
	var dataCylinders = [0,3,4,6,8,10,12];
	var data = [101.5,119.2,37.5,31,31.36538462,24,25.58974359,18.28205128,21.86666667,14.7,20.66666667,13.33333333,18.71428571,12];
	var x = d3.scaleBand().domain(dataCylinders).range([0,183]);
	var y = d3.scaleLinear().domain([0,150]).range([150,0]);
	var width = 700;
	var height = 700;
	var witdthMargin = 60;
	var heightMargin = 50;
	var scalefactor = 350;
	var bar1Color = "green";
	var bar2Color = "blue";

	var graph = d3.select("#my_dataviz2")
				 .append("svg")
				 .attr("viewBox","0,0,"+scalefactor+","+scalefactor)
				 .attr("width",width + 2*witdthMargin)
				 .attr("height",height + 2*heightMargin)
				 .append("g");
	//var data2 = [4,8,15,16,23,42];
	var bar = graph.attr("transform","translate("+witdthMargin+","+heightMargin+")")
				   .selectAll("g")
				   .data(data)
				   .enter()
				   .append("rect")
				   .attr("id", function(d,i) { return "rect" + i; })
				   .attr("x", function(d,i) { return (i)*13; })
				   .attr("y", function(d,i) { return 200-data[i]; })
				   .attr("width", function(d,i) { return 13; })
				   .attr("height", function(d,i) { return data[i]; })
				   .attr("fill", function(d,i) { if (i%2 == 0)
													return bar1Color;
												 else
													return bar2Color;});
	//Axis
	d3.select("#my_dataviz2")
	 .select("svg")
	 .attr("width",width + 2*witdthMargin)
	 .attr("height",height + 2*heightMargin)
	 .append("g")
	 .attr("transform","translate("+witdthMargin+","+(heightMargin+50)+")")
	 .call(d3.axisLeft(y));

	d3.select("#my_dataviz2")
	 .select("svg")
	 .attr("width",width + 2*witdthMargin)
	 .attr("height",height + 2*heightMargin)
	 .append("g")
	 .attr("transform","translate("+witdthMargin+","+(heightMargin+200)+")")
	 .call(d3.axisBottom(x));
	 
	d3.select("#my_dataviz2").select("svg")
	 .append("text")
     .attr("class", "x label")
     .attr("text-anchor", "end")
     .attr("font-size", "10")
     .attr("x", width+witdthMargin-570)
     .attr("y", height+heightMargin-460)
     .text("Car Cylinders");
	d3.select("#my_dataviz2").select("svg")
	 .append("text")
     .attr("class", "y label")
     .attr("text-anchor", "end")
     .attr("y", 8)
     .attr("font-size", "10")
     .attr("y", width+witdthMargin-735)
     .attr("x", height+heightMargin-900)
     .attr("transform", "rotate(-90)")
     .text("Average MPG");
	 
	var svg = d3.select("#my_dataviz2").select("svg")
    svg.append("circle").attr("cx",180).attr("cy",100).attr("r",6).style("fill", bar1Color)
	svg.append("circle").attr("cx",180).attr("cy",117).attr("r",6).style("fill", bar2Color)
	svg.append("text").attr("x", 195).attr("y", 100).text("Avg MPG highway").style("font-size", "10").attr("alignment-baseline","middle")
	svg.append("text").attr("x", 195).attr("y", 117).text("Avg MPG city").style("font-size", "10").attr("alignment-baseline","middle")
}

function initLeftChart() 
{
	var fx = d3.scaleLog().domain([10,150]).range([0,200]);
	var fy = d3.scaleLog().domain([10,150]).range([200,0]);
	var width = 700;
	var height = 700;
	var witdthMargin = 60;
	var heightMargin = 50;
	var scalefactor = 350;

	var graph = d3.select("#my_dataviz1")
				 .append("svg")
				 .attr("viewBox","0,0,"+scalefactor+","+scalefactor)
				 .attr("width",width + 2*witdthMargin)
				 .attr("height",height + 2*heightMargin)
				 .append("g");

	var tooltip = d3.select("#my_dataviz1")
					.append("div")
					.attr("class", "tooltip")
					.style("visibility", "hidden")
					.style("background-color", "white")
					.style("border", "solid")
					.style("border-width", "2px")
					.style("border-radius", "5px")
					.style("padding", "5px")
					.text("I'm a circle!")
					.style("position", "absolute");
					//.text("I'm a circle!");

	var circle = graph.attr("transform","translate("+witdthMargin+","+heightMargin+")")
				    .selectAll("g")
				    .data(data)
				    .enter()
				    .append("circle")
				    .attr("id", function(d,i) { return "circle" + i; })
				    .attr("cx", function(d,i) { return fx(d[4]); })
				    .attr("cy", function(d,i) { return fy(d[3]); })
				    .attr("r", function(d) { return parseInt(d[2])+2; })
				    .attr("fill", defaultFill)
				    .attr("stroke", "blue")
				    .on("mouseover", 
						function(d,i)
						{
							d3.select(this).attr("fill",highlightFill);
							return tooltip.style("top",  (d3.mouse(this)[1]) + height/2-heightMargin + "px")
										.style("left", (d3.mouse(this)[0]) + width/2-witdthMargin + "px")
										.html("<p>Make:\t" + d[0] + 
											"</br>Fuel:\t" + d[1] + 
											"</br>Cylinders:\t" + d[2] + 
											"</br>AvgHighwayMPG:\t" + d[3] + 
											"</br>AvgCityMPG:\t" + d[4])
										.style("visibility", "visible");
						})
					.on("mousemove", 
						function(d,i)
						{
							return tooltip.style("top",  (d3.mouse(this)[1]) + height/2-heightMargin + "px")
										.style("left", (d3.mouse(this)[0]) + width/2-witdthMargin + "px");
						})
				   .on("mouseout", 
						function(d,i)
						{
							d3.select(this).attr("fill",defaultFill);
							return tooltip.style("visibility", "hidden");
						});
	
	//d3.select("svg").selectAll("#circle1").attr("fill","red");

	d3.select("svg")
	 .attr("width",width + 2*witdthMargin)
	 .attr("height",height + 2*heightMargin)
	 .append("g")
	 .attr("transform","translate("+witdthMargin+","+heightMargin+")")
	 .call(d3.axisLeft(fy).tickValues([10,20,50,100]).tickFormat((d, i) => [10,20,50,100][i]));

	d3.select("svg")
	 .attr("width",width + 2*witdthMargin)
	 .attr("height",height + 2*heightMargin)
	 .append("g")
	 .attr("transform","translate("+witdthMargin+","+250+")")
	 .call(d3.axisBottom(fx).tickValues([10,20,50,100]).tickFormat((d, i) => [10,20,50,100][i]));
	
	d3.select("svg")
	 .append("text")
     .attr("class", "x label")
     .attr("text-anchor", "end")
     .attr("font-size", "10")
     .attr("x", width+witdthMargin-570)
     .attr("y", height+heightMargin-460)
     .text("Average MPG City");
	d3.select("svg")
	 .append("text")
     .attr("class", "y label")
     .attr("text-anchor", "end")
     .attr("y", 8)
     .attr("font-size", "10")
     .attr("y", width+witdthMargin-735)
     .attr("x", height+heightMargin-860)
     .attr("transform", "rotate(-90)")
     .text("Average MPG Highway");
}
</script>
</body>
</html>